<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PENGUIN ESCAPE</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jua&family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --vh: 1vh;
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-left: env(safe-area-inset-left);
      --safe-right: env(safe-area-inset-right);
      --font-body: "Noto Sans KR", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-ui: "Jua", "Noto Sans KR", sans-serif;
    }
    html,body{
      margin:0; padding:0;
      width:100%;
      height:100%;
      background:#061018;
      font-family: var(--font-body);
      overflow:visible;
      -webkit-tap-highlight-color: transparent;
    }
    #app{
      position:fixed;
      inset:0;
      height: calc(var(--vh) * 100);
      width:100%;
      overflow:hidden;
      color:#fff;
    }

    /* BG */
    #bg{
      position:absolute; inset:0;
      background:#061018;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      transform: translateZ(0);
      z-index:0;
    }
    #bg.bg-home{
      background-image:url("./asset/images/bg/home.png");
      animation:none;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
    }
    #bg.bg-sea{
      background-image:url("./asset/images/bg/sea.png");
      background-repeat:repeat-x;
      background-size:auto 100%;
      animation: seaBgDrift 26s linear infinite;
      will-change: background-position;
    }
    @keyframes seaBgDrift{
      from { background-position: 0 50%; }
      to { background-position: 1800px 50%; }
    }

    /* Splash blur layer (strong) */
    #bgBlur{
      position:absolute; inset:0;
      display:none;
      background: rgba(0,0,0,.10);
      backdrop-filter: blur(18px);
      z-index:4;
      pointer-events:none;
    }
    #bgBlur.show{ display:block; }

    #splashLogo{
      position:absolute;
      left:50%; top:45%;
      transform:translate(-50%,-50%);
      width:min(82vw, 420px);
      height:auto;
      display:none;
      pointer-events:none;
      z-index:5;
    }
    #splashHint{
      position:absolute;
      left:50%;
      bottom: calc(90px + var(--safe-bottom));
      display:none;
      align-items:center;
      justify-content:center;
      min-width: 170px;
      padding: 8px 18px;
      transform: translateX(-50%);
      z-index:6;
      pointer-events:none;
      text-shadow: 0 4px 10px rgba(0,0,0,.35);
      opacity:.88;
      font-weight:1000;
      letter-spacing: .8px;
      border: 1px solid rgba(255,255,255,.42);
      border-radius: 6px;
      background: rgba(255,255,255,.10);
      box-shadow: 0 6px 20px rgba(0,0,0,.22), inset 0 0 0 1px rgba(255,255,255,.10);
      overflow:hidden;
      animation: splashHintGlow 1.4s ease-in-out infinite;
      font-family: var(--font-ui);
      pointer-events:auto;
      cursor:pointer;
      user-select:none;
    }
    #splashHint::before{
      content:"";
      position:absolute;
      left:-12%;
      width:124%;
      height:42%;
      top:-55%;
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.0));
      filter: blur(2px);
      opacity:0;
      animation: splashHintDrop 1.8s linear infinite;
    }
    #splashHint.show{ display:flex; }
    @keyframes splashHintGlow{
      0%,100%{
        opacity:.82;
        border-color: rgba(255,255,255,.35);
        box-shadow: 0 6px 16px rgba(0,0,0,.20), inset 0 0 0 1px rgba(255,255,255,.08);
      }
      45%{
        opacity:1;
        border-color: rgba(255,255,255,.62);
        box-shadow: 0 8px 22px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.18);
      }
    }
    @keyframes splashHintDrop{
      0%{ top:-55%; opacity:0; }
      15%{ opacity:.8; }
      55%{ opacity:.35; }
      100%{ top:125%; opacity:0; }
    }
    /* Top bar */
    #topBar{
      position:absolute;
      left:0; right:0;
      top:0;
      padding: calc(10px + var(--safe-top)) 14px 10px;
      display:none;
      align-items:center;
      gap:10px;
      z-index:10;
      display:grid;
      grid-template-columns: minmax(0,1fr) auto minmax(0,1fr);
      justify-items:stretch;
    }
    .leftGroup{ display:flex; gap:10px; align-items:center; justify-self:start; }
    .rightGroup{ display:flex; gap:10px; align-items:center; justify-self:end; }
    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      --pill-h: 30px;
      height: var(--pill-h);
      padding:0 10px;
      border-radius:999px;
      background: linear-gradient(180deg, rgba(160,210,245,.95), rgba(90,150,210,.95));
      border:1px solid rgba(255,255,255,.35);
      backdrop-filter: blur(6px);
      font-weight:900;
      font-size:14px;
      white-space:nowrap;
      font-family: var(--font-ui);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.55),
        inset 0 -3px 6px rgba(0,0,0,.18),
        0 6px 14px rgba(0,0,0,.18);
    }
    #goldPill{
      --pill-h: 20px; /* 66% of 30px */
      min-width: 96px;
      justify-content:center;
      background: linear-gradient(180deg, rgba(160,210,245,.95), rgba(90,150,210,.95));
      border-color: rgba(255,255,255,.35);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.55),
        inset 0 -3px 6px rgba(0,0,0,.18),
        0 6px 14px rgba(0,0,0,.18);
      padding-right:6px;
    }
    #stagePill{
      --pill-h: 36px;
      min-width: 140px;
      justify-content:center;
      position:relative;
      flex-direction:column;
      gap:2px;
      padding:6px 14px;
      justify-self:center;
    }
    .modeText{
      font-size:12px;
      opacity:.9;
      letter-spacing:.4px;
    }
    .levelText{
      font-size:16px;
      line-height:1;
      font-weight:1000;
    }
    #goldPlus{
      width:18px;
      height:18px;
      border-radius:50%;
      border:1px solid rgba(0,0,0,.08);
      background:#fff;
      display:grid;
      place-items:center;
      font-weight:1000;
      color:#2b2b2b;
      margin-left:6px;
      cursor:pointer;
    }
    .pill .icon{
      --icon-sz: 36px;
      width:var(--icon-sz);
      height:var(--icon-sz);
      display:inline-grid;
      place-items:center;
      opacity:.98;
    }
    .pill .icon img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      transform: translateY(-6px);
    }

    /* âœ… í™ˆì—ì„œëŠ” ê°€ìš´ë° pillì„ ìˆ¨ê¸¸ ê±°ë¼ wrapperë§Œ ë‚¨ê¹€ */
    #stagePill{
      max-width: 52vw;
      text-align:center;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Setting button (no visible shadow) */
    #btnSetting{
      width:44px; height:44px;
      border-radius:14px;
      border:none;
      background: linear-gradient(180deg, rgba(170,220,255,.95), rgba(90,150,210,.95));
      display:grid; place-items:center;
      cursor:pointer;
      padding:0;
      border:1px solid rgba(255,255,255,.35);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.6),
        inset 0 -3px 6px rgba(0,0,0,.18),
        0 6px 14px rgba(0,0,0,.2);
    }
    #btnSetting img{
      width:28px; height:28px; display:block;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));
      opacity:.95;
    }

    /* HOME */
    #homeLayer{
      position:absolute; inset:0;
      z-index:6;
      display:none;
    }

    /* âœ… í° ë²„íŠ¼ ë” ì•„ë˜ë¡œ + í…ìŠ¤íŠ¸ ì™„ì „ ì¤‘ì•™ */
    #homeButtons{
      position:absolute;
      left:0; right:0;
      bottom: calc(130px + var(--safe-bottom));  /* â¬…ï¸ ë” ì•„ë˜ */
      display:flex;
      justify-content:space-between;
      padding:0 40px;
      gap:14px;
      z-index:8;
    }
    .homeBigBtn{
      width:160px; height:92px;
      border-radius:18px;
      border:none;
      background:transparent;
      padding:0;
      cursor:pointer;
      box-shadow:none;
      outline:none;
      -webkit-appearance:none;
      appearance:none;
    }
    .homeBigBtn:focus,
    .homeBigBtn:focus-visible{
      outline:none;
      box-shadow:none;
    }
    .homeBigBtn img{ width:100%; height:100%; display:block; }

   .homeBtnLabel{
      position:absolute;
      left:0; right:0;
      top:0; bottom:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:1000;
      letter-spacing:.5px;
      color:#ffffff;
      text-shadow: none;
      pointer-events:none;
      font-family: var(--font-ui);
      line-height:1;

      /* âœ… í…ìŠ¤íŠ¸ë¥¼ ë¹¨ê°„ ë°•ìŠ¤ ìª½(ìœ„)ë¡œ ì˜¬ë¦¼ */
     transform: translateY(-5px);
}

    #stageLabel{ font-size:20px; }
    #dailyLabel{ font-size:20px; }

    /* âœ… ë„¤ë¹„ ë²„íŠ¼ ë” ì•„ë˜ */
    #homeNav{
      position:absolute;
      left:0; right:0;
      bottom: calc(26px + var(--safe-bottom)); /* â¬…ï¸ ë” ì•„ë˜ */
      display:flex;
      justify-content:center;
      gap:16px;
      z-index:8;
    }
    .navBtn{
      width:104px; height:70px;
      background:transparent;
      border:none;
      padding:0;
      cursor:pointer;
    }
    .navBtn img{ width:100%; height:100%; display:block; }
    .toggleField{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:8px;
      align-items:center;
    }
    .toggleLabel{
      font-size:12px;
      font-weight:900;
      opacity:.9;
    }
    .toggleSwitch{
      position:relative;
      width:92px;
      height:36px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(220,60,60,.75);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      overflow:hidden;
    }
    .toggleSwitch.on{
      background: rgba(40,180,90,.85);
    }
    .toggleKnob{
      position:absolute;
      top:3px;
      left:3px;
      width:30px;
      height:30px;
      border-radius:50%;
      background:#fff;
      box-shadow: 0 4px 10px rgba(0,0,0,.25);
      transition: transform .18s ease;
    }
    .toggleSwitch.on .toggleKnob{ transform: translateX(56px); }
    .toggleText{
      position:absolute;
      top:0;
      height:100%;
      display:flex;
      align-items:center;
      font-size:12px;
      letter-spacing:.2px;
    }
    .toggleText.on{ left:12px; opacity:0; }
    .toggleText.off{ right:12px; opacity:0; }
    .toggleSwitch.on .toggleText.on{ opacity:.95; }
    .toggleSwitch.off .toggleText.off{ opacity:.95; }
    .langSelect{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:#fff;
      font-weight:900;
      font-family: var(--font-ui);
      appearance:none;
    }
    /* Button press feel */
    button{
      transition: transform .08s ease, filter .08s ease;
      transform-origin: center;
    }
    button:active{
      transform: translateY(2px) scale(0.98);
      filter: brightness(0.92) saturate(0.98);
    }

    /* GAME */
    #gameLayer{
      position:absolute; inset:0;
      z-index:6;
      display:none;
    }

    /* âœ… ë³´ë“œ "ì§„ì§œ ì¤‘ì•™" */
    #gameWrap{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      /* nudge play area 10px downward */
      padding: calc(118px + var(--safe-top)) 14px calc(150px + var(--safe-bottom)) 14px;
    }
    canvas{
      width:min(92vw, 760px);
      aspect-ratio: 1 / 1;
      height:auto;
      touch-action:none;
    }

    /* âœ… í•˜ë‹¨ ë²„íŠ¼: ì•„ì´ì½˜ì´ ê±°ì˜ ê½‰ ì°¨ê²Œ */
    #bottomBar{
      position:absolute;
      left:0; right:0;
      bottom:0;
      padding: 10px 14px calc(18px + var(--safe-bottom));
      display:flex;
      justify-content:center;
      gap:16px;
      z-index:10;
    }
    #bottomBar.tutorialFocusRaise{
      z-index:96;
    }
    .actionBtn{
      --action-w: clamp(108px, 27vw, 156px);
      flex:0 0 var(--action-w);
      width:var(--action-w);
      height:var(--action-w);
      border-radius:16px;
      border:none;
      background: linear-gradient(180deg, rgba(160,210,245,.95), rgba(90,150,210,.95));
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      overflow:hidden;
      position:relative;
      isolation:isolate;
      padding:0;                 /* âœ… */
      border:1px solid rgba(255,255,255,.35);
      box-shadow:
        inset 0 2px 0 rgba(255,255,255,.55),
        inset 0 -3px 6px rgba(0,0,0,.18),
        0 6px 14px rgba(0,0,0,.18);
    }
    .actionIcon{
      width:92%;
      height:92%;
      display:block;
      position:relative;
      z-index:1;
      margin:auto;
      background-repeat: no-repeat;
      background-size: contain;
      background-position: center;
      image-rendering: auto;
    }
    .iconHint{
      background-image: url("./asset/images/ui/new_btn/new_btn_hint.png");
    }
    .iconUndo{
      background-image: url("./asset/images/ui/new_btn/new_btn_undo.png");
    }
    .hintPriceTag{
      margin-top:calc(var(--action-w) * 0.06);
      padding:4px 10px;
      border-radius:999px;
      background: rgba(80,80,80,.9);
      border:1px solid rgba(255,255,255,.18);
      font-weight:900;
      font-size:12px;
      letter-spacing:.2px;
      color:#fff;
      display:inline-flex;
      align-items:center;
      gap:6px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 4px 10px rgba(0,0,0,.25);
    }
    .hintPriceTag .coinImg{ width:18px; height:18px; display:block; }
    .actionStack{
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    /* Toast */
    #toast{
      position:absolute;
      left:0; right:0;
      bottom: calc(210px + var(--safe-bottom));
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index:100;
      opacity:0;
      transform: translateY(8px);
      transition: all .18s ease;
    }
    #toast.show{ opacity:1; transform: translateY(0); }
    #toast .bubble{
      width: min(86vw, 460px);
      padding:14px 18px;
      border-radius:999px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.22);
      backdrop-filter: blur(12px);
      font-weight:1000;
      font-size:18px;
      letter-spacing:.3px;
      text-shadow: 0 2px 8px rgba(0,0,0,.4);
      text-align:center;
    }

    /* Privacy cover */
    #privacyCover{
      position:absolute; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      display:none;
      z-index:80;
    }
    #privacyCover.show{ display:block; }

    /* Overlay */
    .overlay{
      position:absolute; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      z-index:90;
      padding:16px;
    }
    .overlay.show{ display:flex; }
    .card{
      width:min(92vw, 520px);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(10,18,28,.92);
      padding:16px;
      box-shadow: 0 20px 80px rgba(0,0,0,.45);
    }
    .title{
      font-weight:1000;
      font-size:18px;
      margin:0 0 8px;
      font-family: var(--font-ui);
    }
    .desc{ opacity:.85; font-size:13px; line-height:1.5; margin:0 0 14px; white-space:pre-line; }
    .row{ display:flex; gap:10px; justify-content:flex-end; }
    .rowBetween{ display:flex; gap:10px; justify-content:space-between; }

    .bigBtn{
      flex:1;
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.10);
      color:#fff;
      font-weight:1000;
      cursor:pointer;
      font-family: var(--font-ui);
    }
    .ghostBtn{ background: rgba(255,255,255,.06); }
    .dangerBtn{ background: rgba(255,90,90,.22); border-color: rgba(255,90,90,.35); }
    .disabledBtn{
      opacity:.45;
      pointer-events:none;
      filter:saturate(.7);
    }

    /* Loading: penguin sheet animation + text only */
    #loadingOverlay{
      background: rgba(0,0,0,.10);
      backdrop-filter: blur(12px);
    }
    #loadingOverlay.boot{
      background: rgba(246,240,230,1);
      backdrop-filter: none;
    }
    #loadingOverlay.boot .loadingText{
      color:#2b2b2b;
      text-shadow: none;
    }
    #loadingOverlay .card{
      background: transparent;
      border: none;
      box-shadow: none;
      padding: 0;
      text-align:center;
      width: auto;
    }
    .loadingWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 10px;
    }
    .loadingPenguin{
      width: 112px;
      height: 112px;
      background-image: url("./asset/images/penguin/penguin_sheet_03.png");
      background-size: 400% 400%;
      background-repeat: no-repeat;
      background-position: 0% 0%;
      image-rendering: auto;
      animation: loadingPenguinFrames 0.8s steps(1, end) infinite;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }
    /* Logo splash */
    #logoSplash{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:#000;
      opacity:0;
      transition: opacity .6s ease;
      z-index:140;
    }
    #logoSplash.show{
      display:flex;
      opacity:1;
    }
    .logoMark{
      width:120px;
      height:120px;
      border-radius:999px;
      background:#111;
      box-shadow: 0 10px 30px rgba(0,0,0,.6);
    }
    /* Result overlays (clear/fail) */
    #clearOverlay.overlay,
    #failOverlay.overlay{
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
    }
    .resultWrap{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
      padding: 6px 6px 16px;
      pointer-events:auto;
    }
    .resultTitle{
      font-size:44px;
      font-weight:1000;
      letter-spacing:1px;
      color:#ffe38b;
      text-shadow: 0 6px 18px rgba(0,0,0,.35);
      font-family: var(--font-ui);
    }
    .resultDesc{
      font-size:14px;
      font-weight:900;
      color:#ffffff;
      opacity:.9;
    }
    .resultBtns{
      display:flex;
      gap:14px;
      align-items:flex-end;
    }
    .resultBtn{
      min-width:140px;
      padding:12px 16px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.2);
      font-weight:1000;
      color:#fff;
      cursor:pointer;
      background: rgba(80,170,255,.85);
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
    }
    .resultBtn.reward{
      background: rgba(90,190,120,.85);
    }
    .resultBtn.x2{
      background: rgba(255,120,90,.9);
    }
    .adTag{
      position:relative;
      font-size:10px;
      font-weight:1000;
      color:#fff;
      padding:4px 8px;
      border-radius:10px;
      background: rgba(0,0,0,.55);
      margin-bottom:6px;
      text-align:center;
      display:inline-flex;
      gap:6px;
      align-items:center;
    }
    .adTag::after{
      content:"";
      position:absolute;
      left:12px;
      bottom:-5px;
      width:0; height:0;
      border-left:6px solid transparent;
      border-right:6px solid transparent;
      border-top:6px solid rgba(0,0,0,.55);
    }
    .adIcon{
      width:10px;
      height:10px;
      border:2px solid #fff;
      border-radius:2px;
      position:relative;
      box-sizing:border-box;
    }
    .adIcon::before{
      content:"";
      position:absolute;
      left:2px;
      top:1px;
      width:4px; height:6px;
      background:#fff;
      border-radius:1px;
    }
    .heroBadge{
      width:86px;
      height:86px;
      background-image: url("./asset/images/penguin/penguin_hero_sheet_05.png");
      background-size: 400% 400%;
      background-position: 66.666% 100%; /* frame #15 */
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.25));
    }
    .failBadge{
      width:76px;
      height:76px;
      background-image: url("./asset/images/penguin/penguin_sheet_03.png");
      background-size: 400% 400%;
      background-position: 100% 100%; /* frame #16 */
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.25));
    }
    .clearSparkles, .failBubbles{
      position:absolute;
      inset:-40px;
      pointer-events:none;
    }
    .spark{
      position:absolute;
      width:10px; height:10px;
      border-radius:50%;
      background: #fff6a6;
      box-shadow: 0 0 12px rgba(255,230,120,.9);
      animation: sparklePop 1.4s ease-out infinite;
    }
    .spark:nth-child(1){ left:6%; top:12%; animation-delay:0s; width:8px; height:8px; }
    .spark:nth-child(2){ right:6%; top:10%; animation-delay:.15s; width:12px; height:12px; }
    .spark:nth-child(3){ left:18%; top:35%; animation-delay:.25s; width:10px; height:10px; }
    .spark:nth-child(4){ right:20%; top:40%; animation-delay:.05s; width:14px; height:14px; }
    .spark:nth-child(5){ left:35%; bottom:6%; animation-delay:.35s; width:9px; height:9px; }
    .spark:nth-child(6){ right:32%; bottom:8%; animation-delay:.45s; width:11px; height:11px; }
    .spark:nth-child(7){ left:48%; top:6%; animation-delay:.2s; width:7px; height:7px; }
    .spark:nth-child(8){ right:45%; top:55%; animation-delay:.3s; width:13px; height:13px; }
    .spark:nth-child(9){ left:8%; bottom:28%; animation-delay:.4s; width:10px; height:10px; }
    .spark:nth-child(10){ right:10%; bottom:30%; animation-delay:.1s; width:8px; height:8px; }
    @keyframes sparklePop{
      0%{ transform: scale(0.4); opacity:0; }
      25%{ opacity:1; }
      60%{ transform: scale(1.8); opacity:.9; }
      100%{ transform: scale(0.6) translateY(12px); opacity:0; }
    }
    .bubble{
      position:absolute;
      width:12px; height:12px;
      border-radius:50%;
      background: rgba(170,220,255,.9);
      box-shadow: 0 0 10px rgba(140,210,255,.7);
      animation: bubbleUp 1.6s ease-in infinite;
    }
    .bubble:nth-child(1){ left:12%; bottom:8%; animation-delay:0s; }
    .bubble:nth-child(2){ left:28%; bottom:18%; animation-delay:.2s; width:8px; height:8px; }
    .bubble:nth-child(3){ left:50%; bottom:6%; animation-delay:.4s; width:10px; height:10px; }
    .bubble:nth-child(4){ right:18%; bottom:14%; animation-delay:.6s; width:9px; height:9px; }
    .bubble:nth-child(5){ right:6%; bottom:24%; animation-delay:.1s; width:7px; height:7px; }
    @keyframes bubbleUp{
      0%{ transform: translateY(0); opacity:0; }
      20%{ opacity:.9; }
      100%{ transform: translateY(-70px); opacity:0; }
    }
    .loadingText{
      font-family: var(--font-ui);
      font-size: 16px;
      font-weight: 900;
      color: #ffffff;
      text-shadow: 0 2px 8px rgba(0,0,0,.35);
      letter-spacing: .2px;
    }
    @keyframes loadingPenguinFrames{
      0%, 24%{ background-position: 0% 0%; }        /* #1 */
      25%, 49%{ background-position: 33.333% 0%; }  /* #2 */
      50%, 74%{ background-position: 66.666% 0%; }  /* #3 */
      75%, 100%{ background-position: 100% 0%; }    /* #4 */
    }

    /* Tutorial coach */
    #tutorialCoach{
      position:absolute;
      left:0; right:0;
      top: calc(70px + var(--safe-top));
      display:none;
      justify-content:center;
      pointer-events:none;
      z-index:95;
    }
    #tutorialCoach.show{ display:flex; }
    #tutorialCoach .coachCard{
      width:min(92vw, 520px);
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(12,18,28,.72);
      padding:14px;
      box-shadow: 0 20px 80px rgba(0,0,0,.35);
      pointer-events:auto;
    }
    .coachTitle{ font-weight:1000; font-size:16px; margin:0 0 6px; }
    .coachDesc{ opacity:.9; font-size:13px; line-height:1.5; margin:0 0 12px; white-space:pre-line; }
    .pulse{
      animation: pulse 1.2s ease-in-out infinite;
      box-shadow: 0 0 0 0 rgba(255,255,255,.65);
    }
    @keyframes pulse{
      0%{ transform: scale(1); box-shadow:0 0 0 0 rgba(255,255,255,.55); }
      70%{ transform: scale(1.03); box-shadow:0 0 0 10px rgba(255,255,255,0); }
      100%{ transform: scale(1); box-shadow:0 0 0 0 rgba(255,255,255,0); }
    }

    /* Tutorial focus */
    @property --focus-x{
      syntax: '<length-percentage>';
      inherits: true;
      initial-value: 50%;
    }
    @property --focus-y{
      syntax: '<length-percentage>';
      inherits: true;
      initial-value: 50%;
    }
    @property --focus-r{
      syntax: '<length>';
      inherits: true;
      initial-value: 56px;
    }
    #tutorialFocus{
      position:fixed; inset:0;
      display:none;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
      --focus-x: 50%;
      --focus-y: 50%;
      --focus-r: 56px;
      -webkit-mask: radial-gradient(circle var(--focus-r) at var(--focus-x) var(--focus-y), transparent 0, transparent 70%, #000 72%);
      mask: radial-gradient(circle var(--focus-r) at var(--focus-x) var(--focus-y), transparent 0, transparent 70%, #000 72%);
      z-index:94;
      pointer-events:none;
      opacity: 0;
      transition: opacity .22s ease, backdrop-filter .28s ease, --focus-x .28s ease, --focus-y .28s ease, --focus-r .28s ease;
    }
    #tutorialFocus.show{ display:block; opacity:1; }
    .tutorialFocusTarget{
      position:relative;
      z-index:96;
      box-shadow: 0 0 0 6px rgba(120,220,255,.7), 0 0 18px rgba(120,220,255,.9);
      animation: tutorialSpark 1.1s ease-in-out infinite;
    }
    @keyframes tutorialSpark{
      0%{ filter:brightness(1); transform:translateZ(0); }
      50%{ filter:brightness(1.25); }
      100%{ filter:brightness(1); }
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* âœ… Shop money bar inside overlay */
    .moneyBar{
      display:flex;
      gap:10px;
      margin: 10px 0 14px;
      justify-content:flex-start;
    }

    /* Leaderboard */
    .leaderboardMeta{
      font-size:12px;
      opacity:.85;
      margin: 0 0 10px;
    }
    .leaderboardTabs{
      display:flex;
      gap:8px;
      margin:0 0 10px;
    }
    .leaderboardTabs .bigBtn{
      padding:10px 12px;
      flex:1;
    }
    .leaderboardGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin: 0 0 10px;
    }
    .leaderboardPanel{
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      background: rgba(255,255,255,.04);
      padding:10px;
      min-height: 220px;
    }
    .leaderboardPanel .title{
      font-size:14px;
      margin:0 0 8px;
    }
    .leaderboardList{
      margin:0;
      padding:0;
      list-style:none;
      max-height: 280px;
      overflow:auto;
      font-size:12px;
      line-height:1.35;
    }
    .leaderboardList li{
      display:flex;
      justify-content:space-between;
      gap:8px;
      border-bottom:1px solid rgba(255,255,255,.08);
      padding:5px 0;
    }
    .leaderboardList li:last-child{ border-bottom:none; }
    .leaderboardList .me{
      color:#ffe082;
      font-weight:900;
    }
    @media (max-width: 720px){
      .leaderboardGrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="logoSplash" aria-hidden="true">
      <div class="logoMark"></div>
    </div>
    <div id="bg" class="bg-home"></div>
    <div id="bgBlur" class="show"></div>

    <img id="splashLogo" src="./asset/images/ui/logo/logo_pengtal.png" alt="logo"/>
    <div id="splashHint" role="button" tabindex="0" aria-label="tap to start">TAP TO START</div>

    <!-- Top bar -->
    <div id="topBar">
      <div class="leftGroup">
        <div class="pill" id="goldPill">
          <span class="icon"><img src="./asset/images/ui/icon_coin.png" alt="gold"/></span>
          <span id="goldText">0</span>
          <button id="goldPlus" aria-label="open shop">+</button>
        </div>
      </div>

      <!-- âœ… í™ˆì—ì„œëŠ” ìˆ¨ê¹€ ì²˜ë¦¬ë¨ (game.jsì—ì„œ display ì œì–´) -->
      <div class="pill" id="stagePill">
        <div class="modeText" id="modeText">STAGE</div>
        <div class="levelText" id="stagePillText">LEVEL 1</div>
      </div>

      <div class="rightGroup">
        <button id="btnSetting" aria-label="setting">
          <img src="./asset/images/ui/new_btn/new_btn_setting.png" alt="setting"/>
        </button>
      </div>
    </div>

    <!-- HOME -->
    <div id="homeLayer">
      <div id="homeButtons">
        <div style="position:relative;">
          <button id="btnStage" class="homeBigBtn">
            <img src="./asset/images/ui/btn_play.png" alt="play"/>
          </button>
          <div class="homeBtnLabel" id="stageLabel">LEVEL 1</div>
        </div>

        <div style="position:relative;">
          <button id="btnDaily" class="homeBigBtn">
            <img src="./asset/images/ui/btn_daily.png" alt="daily"/>
          </button>
          <div class="homeBtnLabel" id="dailyLabel">ì¼ì¼ ë„ì „</div>
        </div>
      </div>

      <div id="homeNav">
        <button id="btnNavShop" class="navBtn"><img src="./asset/images/ui/btn_shop.png" alt="shop"/></button>
        <button id="btnNavHome" class="navBtn"><img src="./asset/images/ui/btn_home.png" alt="home"/></button>
        <button id="btnNavEvent" class="navBtn"><img src="./asset/images/ui/btn_event.png" alt="event"/></button>
      </div>
    </div>

    <!-- GAME -->
    <div id="gameLayer">
      <div id="gameWrap">
        <canvas id="c"></canvas>
      </div>

      <div id="bottomBar">
        <button id="btnUndo" class="actionBtn undo" aria-label="undo">
          <span class="actionIcon iconUndo" aria-hidden="true"></span>
        </button>
        <div class="actionStack">
          <button id="btnHint" class="actionBtn hint" aria-label="hint">
            <span class="actionIcon iconHint" aria-hidden="true"></span>
          </button>
          <span class="hintPriceTag" aria-hidden="true"><img class="coinImg" src="./asset/images/ui/icon_coin.png" alt="coin"/>100</span>
        </div>
      </div>
    </div>

    <!-- Toast -->
      <div id="toast"><div class="bubble" id="toastText">í† ìŠ¤íŠ¸</div></div>

    <!-- Tutorial focus dim -->
    <div id="tutorialFocus"></div>

    <!-- Tutorial Coach -->
    <div id="tutorialCoach">
      <div class="coachCard">
        <div class="coachTitle" id="tutorialCoachTitle">íŠœí† ë¦¬ì–¼</div>
        <div class="coachDesc" id="tutorialCoachDesc">ì„¤ëª…</div>
        <div class="rowBetween">
          <button id="btnTutorialSkip" class="bigBtn ghostBtn">ê±´ë„ˆë›°ê¸°</button>
          <button id="btnTutorialAction" class="bigBtn" style="display:none;">ì™„ë£Œ</button>
        </div>
      </div>
    </div>

    <!-- Privacy cover -->
    <div id="privacyCover"></div>

    <!-- Loading -->
    <div id="loadingOverlay" class="overlay">
      <div class="card">
        <div class="loadingWrap">
          <div class="loadingPenguin" aria-hidden="true"></div>
          <div class="loadingText">ë¡œë”©ì¤‘</div>
        </div>
      </div>
    </div>

    <!-- Settings -->
    <div id="gearOverlay" class="overlay">
      <div class="card">
        <div class="title">ì„¤ì •</div>
        <div class="desc" id="gearDesc">ì„¤ì •/í™”ë©´ ë³´í˜¸ ì¤‘</div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <div class="toggleField">
            <div class="toggleLabel">BGM</div>
            <button id="btnSound" class="toggleSwitch off" aria-pressed="false" aria-label="BGM toggle">
              <span class="toggleKnob"></span>
              <span class="toggleText on">ON</span>
              <span class="toggleText off">OFF</span>
            </button>
          </div>
          <div class="toggleField">
            <div class="toggleLabel">ì§„ë™</div>
            <button id="btnVibe" class="toggleSwitch off" aria-pressed="false" aria-label="vibe toggle">
              <span class="toggleKnob"></span>
              <span class="toggleText on">ON</span>
              <span class="toggleText off">OFF</span>
            </button>
          </div>
          <div class="toggleField">
            <div class="toggleLabel">ì–¸ì–´</div>
            <select id="selLang" class="langSelect" aria-label="language">
              <option value="ko">í•œêµ­ì–´</option>
              <option value="en">English</option>
              <option value="ja">æ—¥æœ¬èª</option>
            </select>
          </div>
        </div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnTutorial" class="bigBtn">íŠœí† ë¦¬ì–¼ ë³´ê¸°</button>
          <button id="btnProfile" class="bigBtn ghostBtn">í”„ë¡œí•„</button>
        </div>
        <div class="row">
          <button id="btnGoHome" class="bigBtn dangerBtn">í™ˆìœ¼ë¡œ</button>
        </div>
        <div class="row" style="margin-top:10px;">
          <button id="btnCloseGear" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Shop -->
    <div id="shopOverlay" class="overlay">
      <div class="card">
        <div class="title">ìƒì </div>

        <div class="moneyBar">
          <div class="pill"><span class="icon">ğŸª™</span><span id="shopGoldText">0</span></div>
        </div>

        <div class="desc" id="shopDesc">ê³¨ë“œë¥¼ íšë“í•˜ê³  íŒíŠ¸(100ê³¨ë“œ)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.</div>

        <div class="row" style="margin-bottom:10px;">
          <button id="btnShopDailyGold" class="bigBtn">ê³¨ë“œ +70 ë¬´ë£Œíšë“ (1ì¼ 1íšŒ)</button>
        </div>

        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnBuyGold1000" class="bigBtn">ê³¨ë“œ 1000 (â‚©3,300)</button>
          <button id="btnBuyGold2000" class="bigBtn ghostBtn">ê³¨ë“œ 2000 (â‚©5,000)</button>
        </div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnBuyGold3000" class="bigBtn">ê³¨ë“œ 3000 (â‚©7,000)</button>
          <button id="btnBuyGold5000" class="bigBtn ghostBtn">ê³¨ë“œ 5000 (â‚©9,900)</button>
        </div>

        <div class="row">
          <button id="btnCloseShop" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Daily Select -->
    <div id="dailySelectOverlay" class="overlay">
      <div class="card">
        <div class="title">ì¼ì¼ ë„ì „</div>
        <div class="desc" id="dailySelectDesc">ì˜¤ëŠ˜ì˜ 3ë‹¨ê³„ ë„ì „!</div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnDaily1" class="bigBtn">1ë‹¨ê³„</button>
          <button id="btnDaily2" class="bigBtn">2ë‹¨ê³„</button>
          <button id="btnDaily3" class="bigBtn">3ë‹¨ê³„</button>
        </div>
        <div class="row">
          <button id="btnCloseDailySelect" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Tutorial -->
    <div id="tutorialOverlay" class="overlay">
      <div class="card">
        <div class="title">íŠœí† ë¦¬ì–¼</div>
        <div class="desc" id="tutorialText">
1) í­ê·„ì„ ë“œë˜ê·¸í•´ì„œ ìƒ/í•˜/ì¢Œ/ìš°ë¡œ ë¯¸ë„ëŸ¬ëœ¨ë ¤ìš”.
2) ì¥ì• ë¬¼(ë°”ìœ„)ì´ë‚˜ ë‹¤ë¥¸ í­ê·„ì—ì„œ ë©ˆì¶°ìš”.
3) ì£¼ì¸ê³µ(0ë²ˆ í­ê·„)ì„ ê°€ìš´ë° ëª©í‘œ ì§€ì ì— ë„£ìœ¼ë©´ í´ë¦¬ì–´!
4) ë¬´ë¥´ê¸°(UNDO)ëŠ” ë¬´í•œ, íŒíŠ¸ëŠ” 1íšŒ 100ê³¨ë“œë¥¼ ì‚¬ìš©í•´ìš”.
5) ê³¨ë“œê°€ ë¶€ì¡±í•˜ë©´ ìƒì ì—ì„œ ê³¨ë“œë¥¼ íšë“í•  ìˆ˜ ìˆì–´ìš”.
        </div>
        <div class="rowBetween">
          <button id="btnTutorialClose" class="bigBtn">í™•ì¸</button>
        </div>
      </div>
    </div>

    <!-- First login choice -->
    <div id="loginGateOverlay" class="overlay">
      <div class="card">
        <div class="title">ë¡œê·¸ì¸ ì„ íƒ</div>
        <div class="desc" id="loginGateDesc">Google ë¡œê·¸ì¸ìœ¼ë¡œ í´ë¼ìš°ë“œ ì €ì¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ê²ŒìŠ¤íŠ¸ë¡œ ì‹œì‘í•  ìˆ˜ ìˆì–´ìš”.</div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnLoginGateGoogle" class="bigBtn">Google ë¡œê·¸ì¸</button>
          <button id="btnLoginGateGuest" class="bigBtn ghostBtn">ê²ŒìŠ¤íŠ¸ë¡œ ì‹œì‘</button>
        </div>
      </div>
    </div>

    <!-- Profile / Save -->
    <div id="profileOverlay" class="overlay">
      <div class="card">
        <div class="title">í”„ë¡œí•„</div>
        <div class="desc" id="profileDesc">ê³„ì • ì—°ë™ìœ¼ë¡œ í´ë¼ìš°ë“œ ì €ì¥/ë™ê¸°í™”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”.</div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnSetUserId" class="bigBtn">ê³„ì • ì—°ë™</button>
          <button id="btnUseGuest" class="bigBtn ghostBtn">ê²ŒìŠ¤íŠ¸ë¡œ ì‹œì‘</button>
        </div>
        <div class="row">
          <button id="btnCloseProfile" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Account Link -->
    <div id="accountLinkOverlay" class="overlay">
      <div class="card">
        <div class="title">ê³„ì • ì—°ë™</div>
        <div class="desc">ì—°ë™í•  ê³„ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
        <div class="rowBetween" style="margin-bottom:10px;">
          <button id="btnLinkGoogle" class="bigBtn">Google</button>
        </div>
        <div class="row">
          <button id="btnCloseAccountLink" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboardOverlay" class="overlay">
      <div class="card">
        <div class="title">ë¦¬ë”ë³´ë“œ</div>
        <div class="leaderboardMeta" id="leaderboardMeta">ë¡œë”© ì¤‘...</div>
        <div class="leaderboardTabs">
          <button id="btnLeaderboardStage" class="bigBtn">ìŠ¤í…Œì´ì§€</button>
          <button id="btnLeaderboardDaily" class="bigBtn ghostBtn">ì¼ì¼</button>
        </div>
        <div class="leaderboardGrid">
          <div class="leaderboardPanel">
            <div class="title">TOP 50</div>
            <ul id="leaderboardTopList" class="leaderboardList"></ul>
          </div>
          <div class="leaderboardPanel">
            <div class="title">ë‚´ ì£¼ë³€</div>
            <ul id="leaderboardAroundList" class="leaderboardList"></ul>
          </div>
        </div>
        <div class="row">
          <button id="btnCloseLeaderboard" class="bigBtn ghostBtn">ë‹«ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Info -->
    <div id="infoOverlay" class="overlay">
      <div class="card">
        <div class="title" id="infoTitle">ì•ˆë‚´</div>
        <div class="desc" id="infoDesc">ë‚´ìš©</div>
        <div class="row">
          <button id="btnInfoOk" class="bigBtn">í™•ì¸</button>
        </div>
      </div>
    </div>

    <!-- Fail -->
    <div id="failOverlay" class="overlay">
      <div class="resultWrap">
        <div class="failBubbles">
          <span class="bubble"></span>
          <span class="bubble"></span>
          <span class="bubble"></span>
          <span class="bubble"></span>
          <span class="bubble"></span>
        </div>
        <div class="failBadge" aria-hidden="true"></div>
        <div class="resultTitle">ì‹¤íŒ¨</div>
        <div class="resultDesc">ë‹¤ì‹œ ë„ì „í•´ë³¼ê¹Œìš”?</div>
        <div class="resultBtns">
          <button id="btnFailRetry" class="resultBtn">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
      </div>
    </div>

    <!-- Clear -->
    <div id="clearOverlay" class="overlay">
      <div class="resultWrap">
        <div class="clearSparkles">
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
          <span class="spark"></span>
        </div>
        <div class="heroBadge" aria-hidden="true"></div>
        <div class="resultTitle">ì„±ê³µ</div>
        <div class="resultDesc" id="clearDesc">ë³´ìƒ</div>
        <div class="resultBtns">
          <button id="btnClearHome" class="resultBtn reward">ë³´ìƒë°›ê¸°</button>
          <div style="display:flex; flex-direction:column; align-items:center;">
            <div class="adTag"><span class="adIcon" aria-hidden="true"></span>ê´‘ê³ </div>
            <button id="btnClearNext" class="resultBtn x2">X2 ë°›ê¸°</button>
          </div>
        </div>
      </div>
    </div>

    <audio id="bgm" src="./asset/bgm.mp3" loop></audio>

    <script>
      window.PE_SUPABASE_URL = "https://gfyarbdwxzbszwqewbxx.supabase.co";
      window.PE_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmeWFyYmR3eHpic3p3cWV3Ynh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MjI0MzEsImV4cCI6MjA4NjI5ODQzMX0.ezsfFQp5PPAbZ2uxOZxx2zoj0ufvk9u9ts6akGPD2Tc";
    </script>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./supabase-adapter.js"></script>
  <script src="./game.js"></script>
</body>
</html>
