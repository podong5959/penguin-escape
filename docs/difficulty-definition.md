# Penguin Difficulty Definition (D10)

이 문서는 퍼즐 체감 난이도를 `1~10`으로 산정하기 위한 팀 합의 기준이다.

## 합의된 확정 규칙

1. 연속 동일 말(펭귄) 이동 가중치
- 같은 펭귄을 연속으로 움직인 경우, 해당 이동의 난이도 기여치를 `0.5`로 계산한다.
- 다른 펭귄으로 전환된 이동은 기본 가중치 `1.0`으로 계산한다.

2. 골 주변 돌 평가 규칙
- 골 근처 돌이 실제 클리어 경로에서 "골 진입/정지"에 사용되면 `쉬움 점수(assist)`로 반영한다.
- 골 근처 돌이 존재하지만 클리어 경로에서 사용되지 않으면 `어려움 점수(fake)`로 반영한다.

3. 미끼수(decoy) 평가 규칙
- 미끼수는 "정답 진행이 아닌 유효 이동"으로 정의한다.
- 미끼수 평가는 아래 두 축을 함께 사용한다.
- 개수 축: 현재 상태에서 미끼수가 전체 유효 수에서 차지하는 비율
- 깊이 축: 미끼수를 선택했을 때 최단해 기준 손해 수(되돌아오는데 필요한 추가 수)

## 난이도 점수 구성(1~10)

최종 점수 `D10`은 아래 요소를 정규화해 결합한다.

- `effectiveMoves`: 연속 동일 말 0.5 규칙이 반영된 실효 이동량
- `goalAssist`: 골 주변 돌의 쉬움 기여
- `goalFake`: 골 주변 돌의 가짜 단서(헷갈림) 기여
- `decoyScore`: 미끼수 개수 + 깊이 결합 점수

권장 결합 형태:

```text
S = w1*norm(effectiveMoves)
  + w2*norm(goalFake)
  - w3*norm(goalAssist)
  + w4*norm(decoyScore)

D10 = clamp(round(1 + 9*S), 1, 10)
```

초기 가중치 권장:
- `w1=0.35`, `w2=0.20`, `w3=0.15`, `w4=0.30`

## decoyScore 권장 정의

```text
decoyRatio = decoyMoves / legalMoves
decoyPenalty = avg(extraStepsFromDecoy)    // 0~1로 정규화
decoyScore = 0.5*decoyRatio + 0.5*decoyPenalty
```

## 운영 원칙

- 최단해 길이(`minMoves`)만으로 난이도를 결정하지 않는다.
- "쉬워지는 구조(assist)"와 "헷갈리는 구조(fake/decoy)"를 분리해 측정한다.
- 스테이지/일일 모드 모두 동일한 D10 정의를 사용하고, 모드별로는 목표 구간만 다르게 운용한다.

## 적용 기록

### 2026-02-22

- `game.js` 난이도 평가를 D10 공통 평가기로 교체했다.
- 스테이지 1~20은 목표 난이도 `1/2/3`을 `50/30/20` 확률로 선택한다.
- 스테이지 21~9999는 앵커 기반 보간으로, 급상승 구간과 완만 구간이 번갈아 나오도록 목표 난이도 분포 중심을 설계한다.
- 초기(온보딩 직후) 상승은 가파르게, 이후는 완만해졌다가 다시 가파르게 오르는 리듬을 반복한다.
- 스테이지가 높아져도 쉬운 난이도 확률은 0으로 고정하지 않는다(고난도만 강제하지 않음).
- 각 스테이지의 목표 난이도 추첨은 시드 기반으로 고정되어 모든 유저가 동일한 스테이지 퍼즐을 받는다.
- 일일도전 목표 난이도는 날짜 기준 `A/B/C` 로테이션으로 운영한다.
- `A: 3/5/7`, `B: 3/6/9`, `C: 3/6/10` (레벨 1/2/3 순서).
- 관리자 난이도 표시(`난이도 x/10`)는 동일한 D10 평가기를 사용한다.
- D1~D10 분리력 강화를 위해 D10 계산식 가중치를 재조정했다.
- `moveDepth` 절대 스케일 비중을 높여(`0.62`) 타깃 난이도 상승이 실제 난이도 점수 상승으로 이어지게 했다.
- 검증(각 난이도 5판 시뮬레이션): `Spearman(target, avg_diff10)=0.997`, 역전 구간 0개.
